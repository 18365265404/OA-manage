<template>
	<div>
		<div class="wrap weddingAgrStencil" id="print">
			<div>
				<div class="top-img">
				</div>
				<p class="number" >No.<label id="agreementNo"></label></p>
				<p class="server-book">婚礼仪式及宴会服务协议书</p>
				<table class="table1" width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td>甲方 <label id="partyA"></label></td>
						<td>身份证号码 <label id="partyAId"></label></td>
					</tr>
					<tr>
						<td>乙方 <label id="partyB"></label></td>
						<td></td>
					</tr>
				</table>
				<p style="line-height:23px;">根据《中华人民共和国合同法》、《中华人民共和国消费者权益保护法》及有关法律法规和规章，甲 、乙双方在遵循自愿、平等、诚信的原则基础上协商一致，签订本合同。
				</p>
				   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">一、新郎、新娘基本信息</p>
				<table class="table2" style="font-size:12px;" width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">新郎姓名 </td>
						<td width="270"><label id="groomName"></label></td>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">新娘姓名 </td>
						<td width="270"><label id="brideName"></label></td>
					</tr>
					<tr>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">电话 </td>
						<td width="270"><label id="groomMobile"></label></td>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">电话 </td>
						<td width="270"><label id="brideMobile"></label></td>
					</tr>
					<tr>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">出生日期</td>
						<td width="270"> <label id="groomBirthday"></label></td>
						<td width="120" style="background-color:rgba(0,0,0,0.1);">出生日期 </td>
						<td width="270"><label id="brideBirthday"></label></td>
					</tr>
				</table>

				   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">二、服务内容及报价</p>
				<p class="p2">甲方预订婚礼仪式及宴会服务的基本信息、所选套餐包含的服务项目及报价详见本协议附件《服务项目》及《报价清单》。</p>

				   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">三、服务费用支付方式 </p>
				<div class=" dataGoldDiv">

				</div>
			</div>
			   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">四、双方权利义务及服务保障</p>
			<p class="p2">4.1 甲方应按本协议约定，按时、足额向乙方支付相应费用。</p>
			<p class="p2">4.2 甲方应积极协助乙方完成各项准备工作，包含而不限于化妆师试妆、司仪沟通、嘉宾名单确认、礼服试装、婚车扎花等，并在约定的时间到乙方处进行商谈，确保婚礼仪式及宴会顺利进行。如因甲方拖延导致筹备延迟，责任由甲方承担。</p>
			<p class="p2"> 4.3 乙方应严格遵守合同的约定，安全、有效、保质保量、及时地完成各服务项目。</p>
			<p class="p2">4.4 乙方对食品卫生负有责任，若单个菜品发生食品质量问题，经调查属实,乙方须为甲方调换相同的符合质量标准的食品,也可按单个菜品的原价退款。甲方消费者因用餐健康受到损害，经有关部门鉴定属实，乙方应当给予赔偿。</p>
			<p class="p2"> 4.5 由于不可抗力的原因，如台风、地震、骚乱、政府征收征用、及非乙方原因导致的停电、火灾等，导致本协议无法执行，乙方有权终止本协议，并将已付定金退还给甲方。或者经双方协商，在不退换定金的情况下，乙方可提供所有分店合适的宴会厅与档期供甲方挑选使用。</p>
			<p class="p2"> 4.6 本合同签订桌数不可减少，甲方在婚礼举办日前7日确定是否增加桌数，并确定最终桌数，按最终桌数支付费用（新增桌数，无优惠，按菜金原价计算）。</p>
			<p class="p2"> 4.7 乙方提供“一站式”婚礼仪式及宴会服务，甲方选择该套餐表明甲方认可和接受所选套餐包含的所有服务项目（含赠送项目）。甲方不得将所选套餐包含的服务项目（含赠送项目）用于折抵其他应付款。</p>
			<p class="p2"> 4.8 婚礼仪式及宴会服务由乙方及其关联公司(如需)提供和承办，甲方对此表示认可和同意。</p>
			<p class="p2"> 4.9 本协议由新郎、新娘、新郎新娘之外的第三方中的一方或两方签署，后续服务过程中，新郎、新娘签署的与本协议有关的文件或为履行本协议所做的行为对本协议签署方同样有约束力，相关责任由本协议签署方承担。</p>
			<p class="p2">4.10 为方便沟通，甲方在此确认，接受乙方以短信、微信、QQ等方式发送的通知和相关文件。</p>

			   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">五、婚礼仪式及宴会秩序</p>
			<p class="p2">为保证婚礼仪式及宴会的顺利、安全进行，甲方确认在本协议签订时已知悉并遵守以下事项，并承诺婚礼仪式及宴会期间，甲方及受邀出席婚礼的相关人士遵守以下事项：</br>
				5.1禁止携带具有爆炸性、易燃性、放射性等危险物品和管制器具等进入婚礼仪式及宴会会场；</p>
			<p class="p2"> 5.2禁止携带狗、猫等动物及其它危险宠物进入婚礼仪式及宴会会场；</p>
			<p class="p2">5.3 甲方及受邀出席婚礼的相关人士应在婚礼仪式及宴会会场内食用由乙方提供的酒水食物，谢绝任何外带酒水食物。因甲方及受邀出席婚礼的相关人士食用外带食物或自行打包带回食物而引发的问题（包括但不限于食物中毒），与乙方无关。</p>
			<p class="p2"> 5.4无民事行为能力人或限制行为能力人必须有监护人在场陪同并尽到监护义务，如无民事行为能力人或限制行为能力人在婚礼现场发生任何安全事故导致的全部损失及责任甲方及其监护人自行承担，与乙方无关。</p>
			<p class="p2"> 5.5甲方及受邀出席婚礼的相关人士在婚礼会场应注意不得损坏或污损乙方会场的设施设备；如有损坏情况发生，甲方将立即修复或按原价向乙方支付赔偿金。</p>
			<p class="p2"> 5.6禁止在婚礼现场追逐、打闹及其他可能造成他人人身伤害和危害公共安全的行为，由此造成的损失由甲方承担。</p>
			<p class="p2"> 5.7 婚礼仪式及宴会举办期间，甲方及受邀出席婚礼的相关人士应注意保管好随身携带物品，乙方无保管责任，如发生遗失的，损失自行承担，乙方有义务协助甲方调查取证。</p>
			<p class="p2"> 5.8 婚礼仪式区（各婚礼馆所属的仪式堂、露台、草坪等仪式区）使用时间原则为30分钟，每个宴会厅固定仪式区的使用时间短，甲方与甲方嘉宾须服从乙方仪式服务人员的现场安排。</p>

			   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">六、违约责任</p>
			<p class="p2"> 6.1甲方应按照本协议约定按时足额支付相应款项。甲方逾期支付任意一期款项的，每逾期1日，应向乙方支付应付而未付部分金额千分之一的违约金；逾期超过7日或在婚礼举办日前7日仍未付清全款的，乙方有权解除本协议并参照本协议第6.2条追究甲方的违约责任。</p>
			<p class="p2"> 6.2如因甲方原因单方面取消预订的，甲方应按下列情形承担相应的违约责任：</p>
			<table class="table3" style="font-size:12px;" width="100%" cellspacing="0" cellpadding="0">
				<tr>
					<td>情形</td>
					<td>违约责任</td>
				</tr>
				<tr>
					<td>签约日至婚礼举办日前180日取消</td>
					<td>乙方收取合同总价20%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前180日至婚礼举办日前60日取消</td>
					<td>乙方收取合同总价40%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前60日至婚礼举办日前7日取消</td>
					<td>乙方收取合同总价60%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前7日至婚礼举办日前1日取消</td>
					<td>乙方收取合同总价80%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办当日取消的 </td>
					<td>乙方收取合同总价100%的违约金</td>
				</tr>
			</table>
			<p class="p2" style="margin-bottom:0"> 6.3 如因乙方原因单方面取消预订，乙方应按下列情形承担相应的违约责任：</p>
			<table class="table3" style="font-size:12px; text-align: center" width="100%" cellspacing="0" cellpadding="0">
				<tr>
					<td>情形</td>
					<td>违约责任</td>
				</tr>
				<tr>
					<td style="width:40%;">签约日至婚礼举办日前180日取消</td>
					<td>甲方收取合同总价20%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前180日至婚礼举办日前60日取消</td>
					<td>甲方收取合同总价40%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前60日至婚礼举办日前7日取消</td>
					<td>甲方收取合同总价60%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办日前7日至婚礼举办日前1日取消</td>
					<td>甲方收取合同总价80%的违约金</td>
				</tr>
				<tr>
					<td>婚礼举办当日取消的</td>
					<td>甲方收取合同总价100%的违约金</td>
				</tr>
			</table>
			<p class="p2"> 6.4 如甲方违约，乙方有权将已收费用于抵偿违约金、损害赔偿金；不足部分，乙方有权向甲方进一步追偿。</p>
			<p class="p2"> 6.5 鉴于婚宴预订的特殊性 ，甲方如需更改婚礼举办日期则取消所有优惠项目。</p>
			<p class="p2"> 6.6 如乙方提供的产品或服务（含赠送项目）存在瑕疵或因故不能提供给甲方造成损失的，乙方应承担赔偿责任，该赔偿金额以该服务或产品的单项报价为限。</p>

			   <p class="p1" style=" font-family: SimHei;  font-weight: bolder;">七、合同的生效</p>
			<p class="p3"> 7.1 本合同自双方签字或盖章之日起生效，本合同壹式贰份，具有同等效力。其中甲方持有壹份，乙方持有贰份。本协议附件为本合同的组成部分，具有同等效力。</p>
			<p class="p3"> 7.2 本协议未尽事宜，甲、乙双方可另行签订补充协议，补充协议与本协议不一致的地方，以补充协议为准。</p>
			<p class="p3" style="margin-bottom:30px;">7.3 本协议履行过程中发生争议的，甲、乙双方应友好协商解决；协商不成的，提交有管辖权的人民法院管辖。</p>

			<table class="table4" width="100%" cellspacing="0" cellpadding="0">
				<tr>
					<td>甲方（签章）</td>
					<td colspan="2"></td>
					<td>乙方（签章）</td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>新郎</td>
					<td colspan="2"></td>
					<td>联系人</td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>新娘</td>
					<td colspan="2"></td>
					<td>联系电话</td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>日期</td>
					<td colspan="2"></td>
					<td>日期</td>
					<td colspan="2"></td>
				</tr>
			</table>
			<!--<img src="../jsimgcss/images/agreement/again.png" alt="" style="display: inline-block;float: right; margin-top: -170px;margin-right: -90px;">-->
		</div>

	</div>
</template>
<script type="text/ecmascript-6">
    import $ from 'jQuery'
    require("../../../utils/jquery.jqprint-0.3");
    import moment from 'moment'
    import { mapGetters } from 'vuex';
    export default {
        props:{
            hsOrderId:{
                type:String
            },
            isPrintPage:{
                type:Boolean
            }
        },
        data(){
            return{
                openCity:[]
            }
        },
        computed:{
            id(){
                return {
                   "hsOrderId":this.hsOrderId
                }
            },
            PrintPage(){
                return this.isPrintPage
            }
        },
        methods:{
            initOpenCity(){ //所有开通城市
                this.$axios.get('/b/getOpenCityLists',{params:{'pageSize':100}}).then((res2)=>{    //获取所有城市列表
                    if(res2.status == 200){
                        this.openCity =  res2.data.msg;
                    }
                    else{
                        alert(msg)
                    }

                })
            },
            dateDiff(date1, date2){

                var strSeparator = "-"; //日期分隔符
                var oDate1;
                var oDate2;
                var iDays;
                oDate1= date1.split(strSeparator);
                oDate2= date2.split(strSeparator);
                var strDateS = new Date(oDate1[0], oDate1[1]-1, oDate1[2]);
                var strDateE = new Date(oDate2[0], oDate2[1]-1, oDate2[2]);
                iDays = parseInt(Math.abs(strDateS - strDateE ) / 1000 / 60 / 60 /24)//把相差的毫秒数转换为天数
                return iDays ;
            },
            DX(n) {
                if (!/^(0|[1-9]\d*)(\.\d+)?$/.test(n)){return "数据非法"};
                var unit = "千百拾亿千百拾万千百拾元角分", str = "";
                n += "00";
                var p = n.indexOf('.');
                if (p >= 0)
                    n = n.substring(0, p) + n.substr(p+1, 2);
                unit = unit.substr(unit.length - n.length);
                for (var i=0; i < n.length; i++)
                    str += '零壹贰叁肆伍陆柒捌玖'.charAt(n.charAt(i)) + unit.charAt(i);
                return str.replace(/零(千|百|拾|角)/g, "零").replace(/(零)+/g, "零").replace(/零(万|亿|元)/g, "$1").replace(/(亿)万|壹(拾)/g, "$1$2").replace(/^元零?|零分/g, "").replace(/元$/g, "元整");
            },
            initData(){

                this.$axios.post('/order/getHsAgreementDetailsPrint',this.id).then((res)=>{  //获取所有套系
                    if(res.data.res == '0'){
                        //订单详细信息
                      let  orderVo = res.data.msg;
                        //合同信息
                       let   hsAgreementVo = orderVo["hsAgreementDTO"];
                        //款项信息
                      let  hsAgreementFundsVoList = orderVo["hsAgreementFundsList"];
                        //档期信息
                       let hsScheduleVo = orderVo["hsScheduleList"];

                        //加载合同信息
                        for (let i in hsAgreementVo) {
                            $("#" + i).text(hsAgreementVo[i]);
                        }
                        $("#partyB").text(orderVo["companyRegistrationName"]);
                        let arrList = [];
                        let str = '';
                        let strMideele = "";
                        let scheduleTime = moment(hsScheduleVo[0]["scheduleTime"]).format('YYYY-MM-DD');
                        if (hsAgreementFundsVoList != null) {
                            let number = 1;
                            for (let j = 0; j < hsAgreementFundsVoList.length; j++) {
                                if (hsAgreementFundsVoList[j]["type"] == 2) {//款项目为订金
                                    if (hsAgreementFundsVoList[j]["amount"] != null) {
                                        if (hsAgreementFundsVoList[j]["amount"] != null && hsAgreementFundsVoList[j]["lastPaymentTime"] != null ) {
                                            let lastPaymentTime4 = moment(hsAgreementFundsVoList[j]["lastPaymentTime"]).format('YYYY-MM-DD');
                                            let days4 = this.dateDiff(lastPaymentTime4, moment(hsAgreementVo["createTime"]).format('YYYY-MM-DD'));
                                            if(days4 == 0){
                                                arrList.push('<p class="p2 ">3.' + number + ' 本协议签订当日向乙方支付定金人民币' + hsAgreementFundsVoList[j]["amount"] + '元（大写：人民币' + this.DX(hsAgreementFundsVoList[j]["amount"]) + '）。</p>');
                                            }else {
                                                arrList.push('<p class="p2 ">3.' + number + ' 本协议签订后' + days4 + '日向乙方支付定金人民币' + hsAgreementFundsVoList[j]["amount"] + '元（大写：人民币' + this.DX(hsAgreementFundsVoList[j]["amount"]) + '）。</p>');
                                            }
                                        }else {
                                            arrList.push('<p class="p2 ">3.' + number + ' 本协议签订当日向乙方支付定金人民币' + hsAgreementFundsVoList[j]["amount"] + '元（大写：人民币' + this.DX(hsAgreementFundsVoList[j]["amount"]) + '）。</p>');
                                        }
                                    } else {
                                        arrList.push('<p class="p2 ">3.' + number + ' 本协议签订当日向乙方支付定金人民币0元（大写：人民币零元）。</p>');
                                    }
                                    number++;
                                }
                            }
                            for (let j = 0; j < hsAgreementFundsVoList.length; j++) {
                                if (hsAgreementFundsVoList[j]["type"] == 3) {//款项为中款
                                    if (hsAgreementFundsVoList[j]["amount"] != null && hsAgreementFundsVoList[j]["lastPaymentTime"] != null && hsScheduleVo[0] != null && hsScheduleVo[0]["scheduleTime"] != null) {
                                        let lastPaymentTime3 = moment(hsAgreementFundsVoList[j]["lastPaymentTime"]).format('YYYY-MM-DD');
                                        let days3 = this.dateDiff(lastPaymentTime3, moment(scheduleTime).format('YYYY-MM-DD'));
                                        console.log(days3)
                                        strMideele += '<p class="p2 dataTable">3.' + parseInt(arrList.length + 1) + ' 婚礼举办日前' + days3 + '日，甲方应向乙方支付中期服务款人民币' + hsAgreementFundsVoList[j]["amount"] + '元（大写：人民币' + this.DX(hsAgreementFundsVoList[j]["amount"]) + '）；';
                                    } else {
                                        strMideele += '<p class="p2 dataTable">3.' + parseInt(arrList.length + 1) + ' 婚礼举办日前180日，甲方应向乙方支付中期服务款人民币0元（大写：人民币零元）；';
                                    }
                                }
                            }
                            strMideele += '甲、乙双方将在此期间，举办个别商谈会，沟通婚礼要求、设想及流程。</p>';
                            for (let j = 0; j < hsAgreementFundsVoList.length; j++) {
                                if (hsAgreementFundsVoList[j]["type"] == 4) {//款项为尾款
                                    if (hsAgreementFundsVoList[j]["lastPaymentTime"] != null) {
                                        let lastPaymentTime4 = moment(hsAgreementFundsVoList[j]["lastPaymentTime"]).format('YYYY-MM-DD');
                                        let days4 = this.dateDiff(lastPaymentTime4, moment(scheduleTime).format('YYYY-MM-DD'));
                                        console.log(days4)
                                        if (days4 > 0) {
                                            strMideele += '<p class="p2 dataTable">3.' + parseInt(arrList.length + 2) + ' 婚礼举办日前' + days4 + '日，以最终确认的服务金额为依据，付清剩余款项。</p>';
                                        } else {
                                            strMideele += '<p class="p2 dataTable">3.' + parseInt(arrList.length + 2) + ' 婚礼举办当日{' + hsAgreementFundsVoList[j]["lastPaymentRemark"] + '}开始前，甲方需确认最终出席人数，并以最终确认的服务金额为依据，付清剩余款项。</p>';
                                        }
                                        strMideele += '<p class="p2 dataTable">3.' + parseInt(arrList.length + 3) + ' 婚礼举办当日，甲方实际消费金额超过最终确认服务金额的部分，甲方应在婚礼仪式及宴会结束';
                                        strMideele += '时一次性支付给乙方。</p>';
                                        var cityName;
                                        this.openCity.forEach((e)=>{
                                            if(orderVo["cityCode"]==e.cityCode){
                                                cityName=e.cityName
                                            }
                                        })
                                        strMideele += ' <p class="p2 dataTable">3.' + parseInt(arrList.length + 4) + ' 因婚礼举办需要，乙方工作人员（包括但不限于影像、化妆、司仪）须到 <lable style="font-weight:bolder;font-family:SimHei; ">' + cityName + '</lable>区以外地区提供服务的，甲方应按照500元/天/人的标准向乙方支付外地服务费';
                                        strMideele += '。同时甲方还须承担乙方工作人员的往返差旅费、食宿费 。</p>';
                                    }
                                }
                            }
                        } else {
                            arrList.push('<p class="p2 ">3.1 本协议签订当日向乙方支付定金人民币0元（大写：人民币零元）。</p>');
                        }

                        for (let i = 0; i < arrList.length; i++) {
                            str += arrList[i];
                        }
                        str += strMideele;













                        $(".dataGoldDiv").append(str);
                        if(this.PrintPage){
                            $("#print").jqprint();
                        }
                    }

                })

            }
        },
        mounted(){
            this.initOpenCity()
            this.initData();
        }
    }

</script>
